<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enquiry Dashboard</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f6fa;
    margin: 0;
    padding: 20px;
}

/* Dashboard cards */
.cards {
    display: flex;
    gap: 20px;
    max-width: 800px;
    margin: 0 auto 30px auto;
    flex-wrap: wrap;
}

.card {
    flex: 1;
    min-width: 300px;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

.card h3 {
    margin: 0;
    color: #2c3e50;
    font-size: 20px;
}

.card p {
    color: #777;
    margin-top: 10px;
}

/* Sections */
.section {
    max-width: 800px;
    margin: 0 auto 30px auto;
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    display: none; /* Hidden by default */
}

input, textarea {
    width: 100%;
    padding: 12px;
    margin: 10px 0 20px 0;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
}

button {
    background: #3498db;
    color: white;
    padding: 10px 14px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    cursor: pointer;
    margin-right: 8px;
}

button:hover {
    background: #2980b9;
}

/* Inbox cards */
.enquiry-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.meta {
    color: #777;
    font-size: 13px;
    margin-bottom: 10px;
}

.status-badge {
    padding: 5px 10px;
    border-radius: 8px;
    font-size: 12px;
    display: inline-block;
    margin-bottom: 10px;
}

.status-new { background: #e3f2fd; color: #1976d2; }
.status-contacted { background: #fff3e0; color: #f57c00; }
.status-closed { background: #e8f5e9; color: #388e3c; }

@media(max-width: 768px) {
    .cards { flex-direction: column; }
}
</style>
</head>
<body>

<!-- Dashboard Cards -->
<div class="cards">
    <div class="card" id="cardSubmit">
        <h3>Submit New Enquiry</h3>
        <p>Click to open the enquiry submission form.</p>
    </div>
    <div class="card" id="cardInbox">
        <h3>View All Enquiries</h3>
        <p>Click to view all submitted enquiries.</p>
    </div>
</div>

<!-- Submit Form Section -->
<div class="section" id="sectionSubmit">
    <h2>Submit Enquiry</h2>
    <form id="enquiryForm">
        <input type="text" id="name" placeholder="Your Name" required>
        <input type="email" id="email" placeholder="Your Email" required>
        <input type="text" id="phone" placeholder="Phone (optional)">
        <input type="text" id="subject" placeholder="Subject" required>
        <textarea id="message" rows="4" placeholder="Message" required></textarea>
        <button type="submit">Submit Enquiry</button>
    </form>
    <p id="formStatus" style="color: green; display:none; margin-top:10px;">
        Enquiry submitted successfully!
    </p>
</div>

<!-- Inbox Section -->
<div class="section" id="sectionInbox">
    <h2>All Enquiries</h2>
    <div id="enquiriesList">Loading enquiries...</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){

    const cardSubmit = document.getElementById("cardSubmit");
    const cardInbox = document.getElementById("cardInbox");
    const sectionSubmit = document.getElementById("sectionSubmit");
    const sectionInbox = document.getElementById("sectionInbox");

    // Toggle sections when cards are clicked
    cardSubmit.addEventListener("click", ()=>{
        sectionSubmit.style.display = "block";
        sectionInbox.style.display = "none";
    });

    cardInbox.addEventListener("click", ()=>{
        sectionInbox.style.display = "block";
        sectionSubmit.style.display = "none";
    });

    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyAzngl0TI8tcMP3W2i2AUYqtBp5nCFGHkY",
        authDomain: "customer-enquiry-inbox-1a113.firebaseapp.com",
        projectId: "customer-enquiry-inbox-1a113",
        storageBucket: "customer-enquiry-inbox-1a113.firebasestorage.app",
        messagingSenderId: "269813008504",
        appId: "1:269813008504:web:5969c5e659afd38477c58d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const form = document.getElementById("enquiryForm");
    const list = document.getElementById("enquiriesList");

    // Submit Form
    form.addEventListener("submit", async function(e){
        e.preventDefault();
        const data = {
            name: document.getElementById("name").value.trim(),
            email: document.getElementById("email").value.trim(),
            phone: document.getElementById("phone").value.trim(),
            subject: document.getElementById("subject").value.trim(),
            message: document.getElementById("message").value.trim(),
            status: "new",
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        try{
            await db.collection("enquiries").add(data);
            form.reset();
            document.getElementById("formStatus").style.display = "block";
            setTimeout(()=>{ document.getElementById("formStatus").style.display = "none"; },3000);
        }catch(err){
            console.error("Error submitting enquiry:", err);
        }
    });

    // Load Inbox with status buttons
    db.collection("enquiries").orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
        list.innerHTML = "";
        if(snapshot.empty){
            list.innerHTML = "<p>No enquiries yet.</p>";
            return;
        }
        snapshot.forEach(doc=>{
            const e = doc.data();
            const date = e.createdAt ? e.createdAt.toDate().toLocaleString() : "Just now";

            list.innerHTML += `
                <div class="enquiry-card">
                    <div class="status-badge status-${e.status}">
                        ${e.status.toUpperCase()}
                    </div>
                    <h3>${escapeHtml(e.subject)}</h3>
                    <p class="meta">
                        <strong>${escapeHtml(e.name)}</strong><br>
                        ${escapeHtml(e.email)}
                        ${e.phone ? " â€¢ " + escapeHtml(e.phone) : ""}
                        <br>Submitted: ${date}
                    </p>
                    <p>${escapeHtml(e.message)}</p>
                    <div>
                        ${e.status === "new" ? `<button onclick="updateStatus('${doc.id}','contacted')">Mark as Contacted</button>` : ""}
                        ${e.status === "contacted" ? `<button onclick="updateStatus('${doc.id}','closed')">Mark as Closed</button>` : ""}
                        ${e.status !== "new" ? `<button onclick="updateStatus('${doc.id}','new')">Reopen</button>` : ""}
                    </div>
                </div>
            `;
        });
    });

    // Update Status Function
    window.updateStatus = async function(id,status){
        try{
            await db.collection("enquiries").doc(id).update({
                status: status,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }catch(err){
            console.error("Error updating status:", err);
        }
    }

    function escapeHtml(text){
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
    }

});
</script>

</body>
</html>
